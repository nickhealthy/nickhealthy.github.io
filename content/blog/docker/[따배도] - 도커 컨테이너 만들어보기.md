---
title: '[ë”°ë°°ë„] - ë„ì»¤ ì»¨í…Œì´ë„ˆ ë§Œë“¤ì–´ë³´ê¸°'
date: 2021-07-19 23:07:30
category: 'ğŸ³ docker'
thumbnail: { thumbnailSrc }
tags: [docker, linux]
draft: false
---

`dockerfile`ì˜ ê°œë…ê³¼ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ë§Œë“¤ì–´ë³´ê³  ë°°í¬í•´ ë´…ì‹œë‹¤.

## ë¬´ì—‡ì„ ì»¨í…Œì´ë„ˆë¡œ ë§Œë“œëŠ” ê±´ê°€ìš”?

> ë„ì»¤ë€ ê°œë°œí•œ ì• í”Œë¦¬ì¼€ì´ì…˜(ì‹¤í–‰íŒŒì¼)ê³¼ ìš´ì˜í™˜ê²½ì´ ëª¨ë‘ ë“¤ì–´ìˆëŠ” ë…ë¦½ëœ ê³µê°„  
> ê¸°ìˆ  ë©´ì ‘ì—ì„œ ì¡°ê¸ˆ ë” ì „ë¬¸ì ìœ¼ë¡œ ë§í•˜ê¸° ìœ„í•´ í•„ìëŠ” "ë…ë¦½ëœ í™˜ê²½ì—ì„œ í•˜ë‚˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ë™ì‹œí‚¤ê¸° ìœ„í•œ ì½”ë“œì™€ ê·¸ ëª¨ë“  ì¢…ì†ì„±ì„ íŒ¨í‚¤ì§• í•˜ëŠ” ê¸°ìˆ "ì´ë¼ê³  ì—°ìŠµí–ˆì—ˆë‹¤...

- ê°œë°œí•œ í”„ë¡œê·¸ë¨ê³¼ ì‹¤í–‰í™˜ê²½ì„ ëª¨ë‘ ì»¨í…Œì´ë„ˆë¡œ ë§Œë“­ë‹ˆë‹¤.
- MSA(Micro Service Architecture) í™˜ê²½ì˜ Polyglot ì• í”Œë¦¬ì¼€ì´ì…˜ ìš´ì˜

<div class="quote-block">
<div class="quote-block__emoji">ğŸ’¡</div>
<div class="quote-block__content" markdown=1>

`Polyglot` ë€?

ë‹¤ì–‘í•œ ì–¸ì–´ë¡œ(í•´ë‹¹ ì„œë¹„ìŠ¤ë¥¼ êµ¬ì„±í•  ë•Œ ìµœì í™” ëœ í™˜ê²½ì„ êµ¬ì¶•í•˜ê¸° ìœ„í•œ ì–¸ì–´)ìœ¼ë¡œ ê°œë°œí•˜ì—¬ í•˜ë‚˜ì˜ í° ì„œë¹„ìŠ¤ë¥¼ ì´ë£¨ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

</div>
</div>

## ì»¨í…Œì´ë„ˆëŠ” ì–´ë–»ê²Œ ë§Œë“œë‚˜ìš”? Dockerfile ì´ë€?

### Dockerfile

- ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ëª…ë ¹ì–´ ì§‘í•©
- Top-Downìœ¼ë¡œ í•´ì„í•˜ëŠ” ë°©ì‹
- ê³ ìœ ì˜ ì§€ì‹œì–´(Instruction)ì„ ê°€ì§(FROM, COPY, CMD etc..)
- ëŒ€ì†Œë¬¸ì êµ¬ë¶„í•˜ì§€ ì•Šìœ¼ë‚˜ ê°€ë…ì„±ì„ ìœ„í•´ ì‚¬ìš©í•¨

<img width="487" alt="ë„ì»¤íŒŒì¼ ë¬¸ë²•" src="https://user-images.githubusercontent.com/66216102/126177054-1ea4ca77-02e1-48a2-a9c7-660b5eb92fb0.PNG">

## ë‚´ê°€ ë§Œë“  ì»¨í…Œì´ë„ˆë¥¼ ë°°í¬í•˜ë ¤ë©´?

- ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ í›„ ë„ì»¤ í—ˆë¸Œì— pushí•˜ê¸°

```bash
$ docker build -t hello.js:lastst . # dockerimage build
$ docker login # dockerhub login
$ docker push hello.js:latest # dockerhubì— push
```

## ì‹¤ìŠµìœ¼ë¡œ ì»¨í…Œì´ë„ˆ ë§Œë“¤ê³  ë°°í¬í•˜ê¸°

### ì‹¤ìŠµ1 : nodejs ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆ ë§Œë“¤ê¸°

- ì‘ì—… í´ë” ìƒì„± ë° ì†ŒìŠ¤ì½”ë“œ ìƒì„±

```bash
$ mkdir build && cd build # í´ë” ë§Œë“¤ê³  ì§„ì…
$ cat > hello.js
const http = require('http');
const os = require('os');
console.log("Test server starting...");

var handler = function(request, response) {
  console.log("Received request from " + request.connection.remoteAddress);
  response.wirteHead(200);
  response.end("Container Hostname: " + os.hostname() + "\n");
};

var www = http.createServer(handler);
www.listen(8080);

```

- ë„ì»¤ íŒŒì¼ ìƒì„±

```dockerfile
FROM node:12 # ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¥¼ ë…¸ë“œjsë¡œ ì§€ì •
COPY hello.js / # í˜¸ìŠ¤íŠ¸ íŒŒì¼ì„ ì»¨í…Œì´ë„ˆ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬
CMD ["node", "/hello.js"] # ì»¨í…Œì´ë„ˆ ë™ì‘ì‹œ ì‹¤í–‰í•˜ëŠ” ì½”ë“œ
```

- ë„ì»¤íŒŒì¼ì˜ ì´ë¯¸ì§€ ìƒì„±

```bash
$ docker build -t hellojs:latest .
$ docker images # ì´ë¯¸ì§€ ìƒì„± í™•ì¸
```

### ì‹¤ìŠµ2 : ìš°ë¶„íˆ¬ ê¸°ë°˜ì˜ ì›¹ì„œë²„ ì»¨í…Œì´ë„ˆ ë§Œë“¤ê¸°

- ì‘ì—… í´ë” ìƒì„± ë° ì§„ì…

```bash
$ mkdir webserver && cd webserver
```

- ë„ì»¤ íŒŒì¼ ìƒì„±

```dockerfile
FROM ubuntu:18.04
LABEL maintainer="nickhealthy <alskadmlcraz1@gmail.com>"
# install apache
RUN apt-get update \
    && apt-get install -y apache2
RUN echo "TEST WEB" > /var/www/html/index.html
EXPOSE 80
CMD ["/usr/sbin/apache2ctl", "-DFOREGROUND"]

```

- ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ

```bash
$ docker build -t webserver:v1 .
```

- ë„ì»¤ íŒŒì¼ ì‹¤í–‰

```bash
$ docker run -d -p 80:80 --name web webserver:v1
```

### ì»¨í…Œì´ë„ˆ ë°°í¬

```bash
$ docker login # ë„ì»¤ í—ˆë¸Œ ê°œì¸ ë ˆí¬ì§€í† ë¦¬ì— ì˜¬ë¦¬ê¸° ìœ„í•œ ë¡œê·¸ì¸ ì ˆì°¨
$ docker push -t <ë³¸ì¸ID>/hellojs
$ docker push -t <ë³¸ì¸ID>/webserver:v1 # ë²„ì „ì„ ë”°ë¡œ ëª…ì‹œí•˜ì§€ ì•Šì•„ latestì¸ ê²½ìš° ë²„ì „ëª…ì€ ìƒëµ ê°€ëŠ¥
```

## í˜¼ì ì—°ìŠµí•´ë³´ê¸°

### ê¸°ë³¸ êµ¬ì„±

- ë°ë¹„ì•ˆ ë² ì´ìŠ¤ì´ë¯¸ì§€ ì‚¬ìš©
- ë¬´í•œ ë°˜ë³µë¬¸ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
- ë„ì»¤ ì´ë¯¸ì§€ íŒŒì¼ì— fortune ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì¹˜ í›„ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰í•˜ëŠ” í”„ë¡œê·¸ë¨ ì‘ì„±
- í™•ì¸ì ˆì°¨

### ì—°ìŠµ ì‹œì‘

- [webpage.sh] íŒŒì¼

```bash
$ cat > webpage.sh
#!/bin/bash
mkdir /htdocs
while :
do
    /usr/games/fortune > /htdocs/index.html
    sleep 10
done
```

- ë„ì»¤ íŒŒì¼ ìƒì„±

```dockerfile
FROM debian:latest
COPY webpage.sh /
RUN apt-get update \
    && apt-get install -y fortune
RUN ["chmod", "+x", "./webpage.sh"] # í•´ë‹¹ íŒŒì¼ì„ copy í›„ ì‹¤í–‰ ê¶Œí•œì´ ì—†ì–´ì„œ ë”°ë¡œ ì¶”ê°€í•´ ë‘ 
CMD ["./webpage.sh"]

```

- ë„ì»¤ íŒŒì¼ ìƒì„± ë° ì‹¤í–‰

```bash
$ docker build -t fortune:21.02 . # ë„ì»¤ ì´ë¯¸ì§€ íŒŒì¼ ìƒì„±
$ docker run -d --name fortune fortune:21.02 # ë„ì»¤ íŒŒì¼ ì‹¤í–‰
```

- ë„ì»¤ ì‹¤í–‰ íŒŒì¼ ë‚´ë¶€ì—ì„œ í™•ì¸

```bash
$ docker exec -it fortune bash
# ì‰˜ ìŠ¤í¬ë¦½íŠ¸ì— ì‘ì„±í•œ ê²½ë¡œ /htdocs/index.html í™•ì¸
$ cat /htdocs/index.html
```

ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
