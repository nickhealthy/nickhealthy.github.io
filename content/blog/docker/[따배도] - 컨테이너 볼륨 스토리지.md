---
title: '[ë”°ë°°ë„] - ì»¨í…Œì´ë„ˆ ë³¼ë¥¨ ìŠ¤í† ë¦¬ì§€'
date: 2021-08-03 21:04:30
category: 'ğŸ³ docker'
thumbnail: { thumbnailSrc }
tags: [docker, linux]
draft: false
---

ì»¨í…Œì´ë„ˆ ë³¼ë¥¨ ëª…ë ¹ì–´ì™€ ë³¼ë¥¨ ê³µìœ ë¥¼ í†µí•´ ì»¨í…Œì´ë„ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ë°°ì›Œë´…ì‹œë‹¤.

## ì»¨í…Œì´ë„ˆ ë³¼ë¥¨ì´ë€?

- ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆì— ìˆëŠ” ë°ì´í„°ëŠ” ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ëŠ” ì¦‰ì‹œ ë°ì´í„°ê°€ ì‚­ì œë˜ë¯€ë¡œ, **<u>ì¤‘ìš” ë°ì´í„°ëŠ” ë³„ë„ë¡œ ë³´ê´€í•  í•„ìš”ì„±ì´ ìˆìŠµë‹ˆë‹¤.</u>**
- ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **<u>ReadOnly</u>**ë¡œ ìˆ˜ì •ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.
- <u>ì»¨í…Œì´ë„ˆì— ì¶”ê°€ë˜ëŠ” ë°ì´í„°ë“¤ì€ ë³„ë„ì˜ RW ë ˆì´ì–´ì— ì €ì¥</u>ë©ë‹ˆë‹¤.
  - ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰ì‹œí‚¬ ë•Œ(í”„ë¡œì„¸ìŠ¤ë¡œ ë™ì‘ì¤‘) RW ë ˆì´ì–´ê°€ ì‹¤í–‰ë˜ê³ , ëª¨ë“  ë°ì´í„°ëŠ” RW ë ˆì´ì–´ì— ì €ì¥ë©ë‹ˆë‹¤.
  - ì´ê²ƒì„ **Union File System ë˜ëŠ” Overlay**ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤.

## ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ë³´ì¡´í•˜ëŠ” ë°©ë²•

- `-v` ì˜µì…˜ì„ í†µí•´ì„œ ë³¼ë¥¨ì„ `<í˜¸ìŠ¤íŠ¸ path>:<ì»¨í…Œì´ë„ˆ path>` í˜•íƒœë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ì»¨í…Œì´ë„ˆ ì•ˆì— ìŒ“ì¸ ë°ì´í„°ë¥¼ í˜¸ìŠ¤íŠ¸ pathë¡œ ì§€ì •í•´ì„œ ë°ì´í„°ë¥¼ ìŒ“ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- MySQL ì´ë¯¸ì§€ë¥¼ ì´ìš©í•œ ëª…ë ¹ì–´ ì˜ˆì‹œ

```bash
$ docker run -d --name db -v /dbdata:/var/lib/mysql -e MYSQL_ALLOW_EMPTY_PASSWORD=pass mysql:latest
```

### ì´ì™¸ì— ë‹¤ë¥¸ ëª…ë ¹ ì˜µì…˜

- `-v <í˜¸ìŠ¤íŠ¸ path>:<ì»¨í…Œì´ë„ˆ path>:<read write mode>` : _ReadOnly_ ë“±ì˜ ì˜µì…˜ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - `ro` ì˜µì…˜ì„ ë¶€ì—¬í•˜ê²Œ ë˜ë©´, ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ë°ì´í„° ìˆ˜ì • ë¶ˆê°€ëŠ¥
- `-v <ì»¨í…Œì´ë„ˆ path>` : ìë™ìœ¼ë¡œ _/var/lib/docker/volumes/uuid/\_data_ í´ë”ì— ë°ì´í„°ê°€ ë³´ì¡´ë©ë‹ˆë‹¤.

## ì»¨í…Œì´ë„ˆë¼ë¦¬ ë°ì´í„° ê³µìœ í•˜ê¸°

- ì»¨í…Œì´ë„ˆë¥¼ ìš´ìš©í•˜ë©´ì„œ ìŒ“ì¸ ë°ì´í„°ë¥¼ í•´ë‹¹ ì»¨í…Œì´ë„ˆì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œ ë°ì´í„°ì˜ ì‚¬ìš©ì´ í•„ìš”í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì˜ˆì‹œ

- ì•„ë˜ ì˜ˆì‹œëŠ” dfë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ì»¨í…Œì´ë„ˆê°€ /webdata ë””ë ‰í† ë¦¬ì— ë°ì´í„°ë¥¼ ì €ì¥ì‹œì¼œ ì£¼ê³ ,
- ìš°ë¶„íˆ¬ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»¨í…Œì´ë„ˆê°€ í•´ë‹¹ ë””ë ‰í† ë¦¬ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ readonlyë¡œ ì‚¬ìš©ì¤‘ì¸ ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

```bash
# dfë¼ëŠ” ì´ë¦„ì˜ ì»¨í…Œì´ë„ˆ ìƒì„± í›„ /webdataì— ë°ì´í„°ë¥¼ ë³¼ë¥¨ ë§ˆìš´íŠ¸
$ docker run -v /webdata:/webdata -d --name df swjoolinux/df:latest
# ìš°ë¶„íˆ¬ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»¨í…Œì´ë„ˆì—ì„œ /webdataì— ìŒ“ì¸ ë°ì´í„°ë¥¼ ro(readonly)ë¡œ ì‚¬ìš©
$ docker run -d -v /webdata:/usr/share/nginx/html:ro ubuntu:latest
```

## ì‹¤ìŠµ

### MySQL ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ í†µí•œ data ì˜êµ¬ ë³´ì¡´í•˜ê¸°

- ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰ ë° */dbdata*ì— ì €ì¥í•˜ê¸°
  - _/dbdata_ ë””ë ‰í† ë¦¬ê°€ ë³„ë„ë¡œ ìƒì„±ë˜ì–´ ìˆì§€ ì•Šì•„ë„ í•´ë‹¹ ë””ë ‰í† ë¦¬ê°€ ì—†ë‹¤ë©´ ìë™ ìƒì„±ë©ë‹ˆë‹¤.

```bash
$ docker run -d --name db -v /dbdata:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=pass mysql:latest
```

- ì»¨í…Œì´ë„ˆ ì•ˆì— ì ‘ì†í•˜ê¸°

```bash
$ docker exec -it db /bin/bash
```

- ì»¨í…Œì´ë„ˆ ì•ˆì— ìˆëŠ” MySQL ì ‘ì†

```bash
$ mysql -u root -ppass
# mysql
# ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
show databases;
# swjoo - database ë§Œë“¤ê¸°
create database swjoo;
exit # mysql out
exit # ì»¨í…Œì´ë„ˆ out
```

- í˜¸ìŠ¤íŠ¸ PC ì•ˆì— ë³¼ë¥¨ í™•ì¸

```bash
$ cd /dbdata/
$ ls
# swjoo í´ë”ê°€ ìƒì„±ë˜ì–´ ìˆìŒì„ í™•ì¸
```

- ì»¨í…Œì´ë„ˆ ì‚­ì œí•´ë„ ë°ì´í„°ë² ì´ìŠ¤ê°€ ë‚¨ì•„ìˆëŠ”ì§€ í™•ì¸í•˜ê¸°

```bash
$ docker rm -f db
$ cd /dbdata
```

#### ë³„ì²¨ - í˜¸ìŠ¤íŠ¸ path ìƒëµ

- í˜¸ìŠ¤íŠ¸ path ìƒëµ ì‹œ `/var/lib/docker/volumes/UUID(ê³ ìœ ì´ë¦„-inspectë¡œ í™•ì¸ê°€ëŠ¥)/_data` í´ë”ì— ë°ì´í„°ê°€ ìƒì„±ë©ë‹ˆë‹¤.

```bash
$ docker run -d --name db -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=pass mysql:latest
```

#### ë³¼ë¥¨ê³¼ ê´€ë ¨ëœ ì»¤ë§¨ë“œ

- ë„ì»¤ ë³¼ë¥¨ì„ ì‚¬ìš©í•˜ê³  ìˆëŠ” ëª©ë¡ í™•ì¸í•˜ê¸°

```bash
$ docker volume ls
```

- ë„ì»¤ ë³¼ë¥¨ ì‚­ì œí•˜ê¸°

```bash
$ docker volume rm ë³¼ë¥¨ ì•„ì´ë””
```

### ì‹¤ìŠµ2 - ì›¹ë°ì´í„°ë¥¼ ì»¨í…Œì´ë„ˆì— ì§€ì›í•˜ê¸°

- ë°ì´í„° ë””ë ‰í† ë¦¬ ìƒì„± ë° ë°ì´í„° ì…ë ¥

```bash
$ mkdir /webdata && cd /webdata
$ echo "<h1>youtube swjoo</h1>" > index.html
```

- ë³¼ë¥¨ì„ ì´ìš©í•œ nginx ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ë° `curl` ëª…ë ¹ì–´ë¡œ ê²€ì¦
  - _/usr/share/nginx/html:ro_ : nginxì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ê²½ë¡œ(roëŠ” ReadOnly ì˜µì…˜)

```bash
$ docker run -d --name web -v /webdata:/usr/share/nginx/html:ro -p 80:80 nginx:latest
$ curl localhost:80
```

<div class="quote-block">
<div class="quote-block__emoji">ğŸ’¡</div>
<div class="quote-block__content" markdown=1>

df ëª…ë ¹ì–´

- ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ì„ ëª¨ë‹ˆí„°ë§ í•  ë•Œ ì‚¬ìš©
- root íŒŒì¼ì‹œìŠ¤í…œ ì‚¬ìš©ëŸ‰ í™•ì¸ ëª…ë ¹ì–´

```bash
$ df -h /
```

</div>
</div>

### ì‹¤ìŠµ3 - ì»¨í…Œì´ë„ˆë¼ë¦¬ ë°ì´í„° ê³µìœ í•˜ê¸°

- ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
  - ì»¨í…Œì´ë„ˆì— ì‚¬ìš©í•  ë°ì´í„° ìƒì„±

```bash
$ cat df.sh
#!/bin/bash
mkdir -p /webdata
while true
do
  df -h / > /webdata/index.html # rootì˜ íŒŒì¼ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ ë°ì´í„°ë¥¼ ìƒì„± í›„, ë¦¬ë‹¤ì´ë ‰íŠ¸
  sleep 10
done
```

- _df.sh_ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ dockerfile íŒŒì¼ ìƒì„±

```dockerfile
$ cat dockerfile
FROM ubuntu:18.04
ADD df.sh /bin/df.sh
RUN chmod +x /bin/df.sh
ENTRYPOINT ["/bin/df.sh"]
```

- dockerfile ì´ë¯¸ì§€ ë¹Œë“œ

```bash
$ docker build -t alskadmlcraz/df:latest .
```

- _/webdata_ í´ë”ì— ë°ì´í„°ë¥¼ ìŒ“ëŠ” ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
$ docker run -v /webdata:/webdata -d alskadmlcraz/df:latest
```

- */webdata*ì˜ ë°ì´í„°ë¥¼ ì´ìš©í•˜ëŠ” nginx ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ë° ê²€ì¦

```bash
$ docker run -d --name web -v /webdata:/usr/share/nginx/html:ro -p 80:80 nginx:latest
$ curl localhost:80
# ì•„ë˜ ë‹¤ìˆ˜ì˜ ë°ì´í„°ê°€ ìŒ“ì—¬ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ
Filesystem      Size  Used Avail Use% Mounted on
overlay          17G  4.9G   11G  31% /
Filesystem      Size  Used Avail Use% Mounted on
overlay          17G  4.9G   11G  31% /
Filesystem      Size  Used Avail Use% Mounted on
overlay          17G  4.9G   11G  31% /
Filesystem      Size  Used Avail Use% Mounted on
overlay          17G  4.9G   11G  31% /
Filesystem      Size  Used Avail Use% Mounted on
overlay          17G  4.9G   11G  31% /
Filesystem      Size  Used Avail Use% Mounted on
overlay          17G  4.9G   11G  31% /
Filesystem      Size  Used Avail Use% Mounted on
overlay          17G  4.9G   11G  31% /
Filesystem      Size  Used Avail Use% Mounted on
overlay          17G  4.9G   11G  31% /
...
```

- ëª¨ë“  ìì› ì‚­ì œ

```bash
$ docker system prune
```
