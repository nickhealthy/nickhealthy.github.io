{"componentChunkName":"component---src-templates-blog-post-js","path":"/cloud/[AWS] NAT 인스턴스를 통한 인터넷 연결/","result":{"data":{"site":{"siteMetadata":{"title":"Woo's Dev Log","author":"nickhealthy","siteUrl":"https://nickhealthy.github.io","comment":{"disqusShortName":"","utterances":"nickhealthy/nickhealthy.github.io"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"7cd78aad-71a7-5bcc-9970-7a4c7836aad0","excerpt":"NAT 인스턴스를 통하여 프라이빗 서브넷에 인스턴스가 외부 인터넷으로 통신을 가능하게 하는 실습 실습 단계 기본 환경 구성 CloudFormation 적용 생성 자원 확인 기본 환경 검증 NAT 인스턴스 실습 NAT 인스턴스 동작을 위한 스크립트 확인 NAT 인스턴스 동작을 위한 설정 프라이빗 서브넷에 위치한 인스턴스에서 외부로 통신 확인 자원 삭제 기본 환경 구성 CloudFormation 스택 생성 이전 실습 방법 참고 AWS 인프라 자원을 생성할 YAML 파일 VPC (10.40.0.0/1…","html":"<p>NAT 인스턴스를 통하여 프라이빗 서브넷에 인스턴스가 외부 인터넷으로 통신을 가능하게 하는 실습</p>\n<h2 id=\"실습-단계\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%EC%8A%B5-%EB%8B%A8%EA%B3%84\" aria-label=\"실습 단계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실습 단계</h2>\n<h3 id=\"기본-환경-구성\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1\" aria-label=\"기본 환경 구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본 환경 구성</h3>\n<ol>\n<li>CloudFormation 적용</li>\n<li>생성 자원 확인</li>\n<li>기본 환경 검증</li>\n</ol>\n<h3 id=\"nat-인스턴스-실습\" style=\"position:relative;\"><a href=\"#nat-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%EC%8B%A4%EC%8A%B5\" aria-label=\"nat 인스턴스 실습 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT 인스턴스 실습</h3>\n<ol>\n<li>NAT 인스턴스 동작을 위한 스크립트 확인</li>\n<li>NAT 인스턴스 동작을 위한 설정</li>\n<li>프라이빗 서브넷에 위치한 인스턴스에서 외부로 통신 확인</li>\n</ol>\n<h3 id=\"자원-삭제\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EC%9B%90-%EC%82%AD%EC%A0%9C\" aria-label=\"자원 삭제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자원 삭제</h3>\n<h2 id=\"기본-환경-구성-1\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1-1\" aria-label=\"기본 환경 구성 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본 환경 구성</h2>\n<h3 id=\"cloudformation-스택-생성\" style=\"position:relative;\"><a href=\"#cloudformation-%EC%8A%A4%ED%83%9D-%EC%83%9D%EC%84%B1\" aria-label=\"cloudformation 스택 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CloudFormation 스택 생성</h3>\n<ul>\n<li>이전 실습 방법 참고</li>\n<li>\n<p>AWS 인프라 자원을 생성할 [YAML 파일]</p>\n<ul>\n<li>VPC (<em>10.40.0.0/16</em>)</li>\n<li>인터넷 게이트웨이</li>\n<li>퍼블릭 서브넷</li>\n<li>퍼블릭 라우팅 테이블(<em>0.0.0.0(모든 네트워크)</em>)</li>\n<li>프라이빗 서브넷 (<em>10.40.2.0/24</em>)</li>\n<li>프라이빗 라우팅 테이블</li>\n<li>퍼블릭 인스턴스 1개, 프라이빗 인스턴스 2개</li>\n<li>보안그룹 2개</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">Parameters</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">KeyName</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> Name of an existing EC2 KeyPair to enable SSH access to the instances. Linked to AWS Parameter\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>KeyPair<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>KeyName\n    <span class=\"token key atrule\">ConstraintDescription</span><span class=\"token punctuation\">:</span> must be the name of an existing EC2 KeyPair.\n  <span class=\"token key atrule\">LatestAmiId</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> (DO NOT CHANGE)\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'AWS::SSM::Parameter::Value&lt;AWS::EC2::Image::Id>'</span>\n    <span class=\"token key atrule\">Default</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2'</span>\n    <span class=\"token key atrule\">AllowedValues</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> /aws/service/ami<span class=\"token punctuation\">-</span>amazon<span class=\"token punctuation\">-</span>linux<span class=\"token punctuation\">-</span>latest/amzn2<span class=\"token punctuation\">-</span>ami<span class=\"token punctuation\">-</span>hvm<span class=\"token punctuation\">-</span>x86_64<span class=\"token punctuation\">-</span>gp2\n\n<span class=\"token key atrule\">Resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">VPC1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>VPC\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">CidrBlock</span><span class=\"token punctuation\">:</span> 10.40.0.0/16\n      <span class=\"token key atrule\">EnableDnsSupport</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token key atrule\">EnableDnsHostnames</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> NATInstance<span class=\"token punctuation\">-</span>VPC1\n  <span class=\"token key atrule\">InternetGateway1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>InternetGateway\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> NATInstance<span class=\"token punctuation\">-</span>IGW1\n  <span class=\"token key atrule\">InternetGatewayAttachment1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>VPCGatewayAttachment\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">InternetGatewayId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> InternetGateway1\n      <span class=\"token key atrule\">VpcId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> VPC1\n\n  <span class=\"token key atrule\">RouteTable1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>RouteTable\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">VpcId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> VPC1\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> NATInstance<span class=\"token punctuation\">-</span>PublicRouteTable1\n  <span class=\"token key atrule\">DefaultRoute1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Route\n    <span class=\"token key atrule\">DependsOn</span><span class=\"token punctuation\">:</span> InternetGatewayAttachment1\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">RouteTableId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> RouteTable1\n      <span class=\"token key atrule\">DestinationCidrBlock</span><span class=\"token punctuation\">:</span> 0.0.0.0/0\n      <span class=\"token key atrule\">GatewayId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> InternetGateway1\n  <span class=\"token key atrule\">Subnet1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Subnet\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">VpcId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> VPC1\n      <span class=\"token key atrule\">AvailabilityZone</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Select</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token tag\">!GetAZs</span> <span class=\"token string\">''</span><span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">CidrBlock</span><span class=\"token punctuation\">:</span> 10.40.1.0/24\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> NATInstance<span class=\"token punctuation\">-</span>VPC1<span class=\"token punctuation\">-</span>Subnet1\n  <span class=\"token key atrule\">Subnet1RouteTableAssociation</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>SubnetRouteTableAssociation\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">RouteTableId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> RouteTable1\n      <span class=\"token key atrule\">SubnetId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> Subnet1\n\n  <span class=\"token key atrule\">RouteTable2</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>RouteTable\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">VpcId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> VPC1\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> NATInstance<span class=\"token punctuation\">-</span>PrivateRouteTable1\n  <span class=\"token key atrule\">Subnet2</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Subnet\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">VpcId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> VPC1\n      <span class=\"token key atrule\">AvailabilityZone</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Select</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token tag\">!GetAZs</span> <span class=\"token string\">''</span><span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">CidrBlock</span><span class=\"token punctuation\">:</span> 10.40.2.0/24\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> NATInstance<span class=\"token punctuation\">-</span>VPC1<span class=\"token punctuation\">-</span>Subnet2\n  <span class=\"token key atrule\">Subnet2RouteTableAssociation</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>SubnetRouteTableAssociation\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">RouteTableId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> RouteTable2\n      <span class=\"token key atrule\">SubnetId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> Subnet2\n\n  <span class=\"token key atrule\">Instance1ENIEth0</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>NetworkInterface\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">SubnetId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> Subnet1\n      <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> Instance1 eth0\n      <span class=\"token key atrule\">GroupSet</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token tag\">!Ref</span> SG1\n      <span class=\"token key atrule\">PrivateIpAddress</span><span class=\"token punctuation\">:</span> 10.40.1.100\n      <span class=\"token comment\">#SourceDestCheck: false</span>\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> NAT<span class=\"token punctuation\">-</span>Instance eth0\n  <span class=\"token key atrule\">VPCEIP1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EIP\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">Domain</span><span class=\"token punctuation\">:</span> vpc\n  <span class=\"token key atrule\">VPCAssociateEIP1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EIPAssociation\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">AllocationId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!GetAtt</span> VPCEIP1.AllocationId\n      <span class=\"token key atrule\">NetworkInterfaceId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> Instance1ENIEth0\n\n  <span class=\"token key atrule\">Instance1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Instance\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">ImageId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> LatestAmiId\n      <span class=\"token key atrule\">InstanceType</span><span class=\"token punctuation\">:</span> t2.micro\n      <span class=\"token key atrule\">KeyName</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> KeyName\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> NAT<span class=\"token punctuation\">-</span>Instance\n      <span class=\"token key atrule\">NetworkInterfaces</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">NetworkInterfaceId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> Instance1ENIEth0\n          <span class=\"token key atrule\">DeviceIndex</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n      <span class=\"token key atrule\">UserData</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">Fn::Base64</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          #!/bin/bash\n          hostname NAT-Instance\n          cat &lt;&lt;EOF>> /etc/sysctl.conf\n          net.ipv4.ip_forward=1\n          net.ipv4.conf.eth0.send_redirects=0\n          EOF\n          sysctl -p /etc/sysctl.conf\n          yum -y install iptables-services\n          systemctl start iptables &amp;&amp; systemctl enable iptables\n          iptables -F\n          iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\n          service iptables save</span>\n\n  <span class=\"token key atrule\">Instance2</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Instance\n    <span class=\"token key atrule\">DependsOn</span><span class=\"token punctuation\">:</span> Instance1\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">ImageId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> LatestAmiId\n      <span class=\"token key atrule\">InstanceType</span><span class=\"token punctuation\">:</span> t2.micro\n      <span class=\"token key atrule\">KeyName</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> KeyName\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> Private<span class=\"token punctuation\">-</span>EC2<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n      <span class=\"token key atrule\">NetworkInterfaces</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">DeviceIndex</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n          <span class=\"token key atrule\">SubnetId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> Subnet2\n          <span class=\"token key atrule\">GroupSet</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token tag\">!Ref</span> SG2\n          <span class=\"token key atrule\">PrivateIpAddress</span><span class=\"token punctuation\">:</span> 10.40.2.101\n      <span class=\"token key atrule\">UserData</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">Fn::Base64</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          #!/bin/bash\n          (\n          echo \"qwe123\"\n          echo \"qwe123\"\n          ) | passwd --stdin root\n          sed -i \"s/^PasswordAuthentication no/PasswordAuthentication yes/g\" /etc/ssh/sshd_config\n          sed -i \"s/^#PermitRootLogin yes/PermitRootLogin yes/g\" /etc/ssh/sshd_config\n          service sshd restart\n          hostnamectl --static set-hostname Private-EC2-1</span>\n\n  <span class=\"token key atrule\">Instance3</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Instance\n    <span class=\"token key atrule\">DependsOn</span><span class=\"token punctuation\">:</span> Instance1\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">ImageId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> LatestAmiId\n      <span class=\"token key atrule\">InstanceType</span><span class=\"token punctuation\">:</span> t2.micro\n      <span class=\"token key atrule\">KeyName</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> KeyName\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> Private<span class=\"token punctuation\">-</span>EC2<span class=\"token punctuation\">-</span><span class=\"token number\">2</span>\n      <span class=\"token key atrule\">NetworkInterfaces</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">DeviceIndex</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n          <span class=\"token key atrule\">SubnetId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> Subnet2\n          <span class=\"token key atrule\">GroupSet</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token tag\">!Ref</span> SG2\n          <span class=\"token key atrule\">PrivateIpAddress</span><span class=\"token punctuation\">:</span> 10.40.2.102\n      <span class=\"token key atrule\">UserData</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">Fn::Base64</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          #!/bin/bash\n          (\n          echo \"qwe123\"\n          echo \"qwe123\"\n          ) | passwd --stdin root\n          sed -i \"s/^PasswordAuthentication no/PasswordAuthentication yes/g\" /etc/ssh/sshd_config\n          sed -i \"s/^#PermitRootLogin yes/PermitRootLogin yes/g\" /etc/ssh/sshd_config\n          service sshd restart\n          hostnamectl --static set-hostname Private-EC2-2</span>\n\n  <span class=\"token key atrule\">SG1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>SecurityGroup\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">VpcId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> VPC1\n      <span class=\"token key atrule\">GroupDescription</span><span class=\"token punctuation\">:</span> VPC1<span class=\"token punctuation\">-</span>NATInstance<span class=\"token punctuation\">-</span>SecurityGroup\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> VPC1<span class=\"token punctuation\">-</span>NATInstance<span class=\"token punctuation\">-</span>SecurityGroup\n      <span class=\"token key atrule\">SecurityGroupIngress</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">IpProtocol</span><span class=\"token punctuation\">:</span> tcp\n          <span class=\"token key atrule\">FromPort</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'22'</span>\n          <span class=\"token key atrule\">ToPort</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'22'</span>\n          <span class=\"token key atrule\">CidrIp</span><span class=\"token punctuation\">:</span> 0.0.0.0/0\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">IpProtocol</span><span class=\"token punctuation\">:</span> tcp\n          <span class=\"token key atrule\">FromPort</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'80'</span>\n          <span class=\"token key atrule\">ToPort</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'80'</span>\n          <span class=\"token key atrule\">CidrIp</span><span class=\"token punctuation\">:</span> 10.40.0.0/16\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">IpProtocol</span><span class=\"token punctuation\">:</span> tcp\n          <span class=\"token key atrule\">FromPort</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'443'</span>\n          <span class=\"token key atrule\">ToPort</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'443'</span>\n          <span class=\"token key atrule\">CidrIp</span><span class=\"token punctuation\">:</span> 10.40.0.0/16\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">IpProtocol</span><span class=\"token punctuation\">:</span> udp\n          <span class=\"token key atrule\">FromPort</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'0'</span>\n          <span class=\"token key atrule\">ToPort</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'65535'</span>\n          <span class=\"token key atrule\">CidrIp</span><span class=\"token punctuation\">:</span> 10.40.0.0/16\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">IpProtocol</span><span class=\"token punctuation\">:</span> icmp\n          <span class=\"token key atrule\">FromPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">-1</span>\n          <span class=\"token key atrule\">ToPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">-1</span>\n          <span class=\"token key atrule\">CidrIp</span><span class=\"token punctuation\">:</span> 0.0.0.0/0\n\n  <span class=\"token key atrule\">SG2</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EC2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>SecurityGroup\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">VpcId</span><span class=\"token punctuation\">:</span> <span class=\"token tag\">!Ref</span> VPC1\n      <span class=\"token key atrule\">GroupDescription</span><span class=\"token punctuation\">:</span> VPC1<span class=\"token punctuation\">-</span>PrivateEC2<span class=\"token punctuation\">-</span>SecurityGroup\n      <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Key</span><span class=\"token punctuation\">:</span> Name\n          <span class=\"token key atrule\">Value</span><span class=\"token punctuation\">:</span> VPC1<span class=\"token punctuation\">-</span>PrivateEC2<span class=\"token punctuation\">-</span>SecurityGroup\n      <span class=\"token key atrule\">SecurityGroupIngress</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">IpProtocol</span><span class=\"token punctuation\">:</span> tcp\n          <span class=\"token key atrule\">FromPort</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'22'</span>\n          <span class=\"token key atrule\">ToPort</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'22'</span>\n          <span class=\"token key atrule\">CidrIp</span><span class=\"token punctuation\">:</span> 10.40.0.0/0\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">IpProtocol</span><span class=\"token punctuation\">:</span> icmp\n          <span class=\"token key atrule\">FromPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">-1</span>\n          <span class=\"token key atrule\">ToPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">-1</span>\n          <span class=\"token key atrule\">CidrIp</span><span class=\"token punctuation\">:</span> 0.0.0.0/0</code></pre></div>\n<h3 id=\"기본-환경-검증\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8-%ED%99%98%EA%B2%BD-%EA%B2%80%EC%A6%9D\" aria-label=\"기본 환경 검증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본 환경 검증</h3>\n<ul>\n<li>\n<p>기본적으로 프라이빗 EC2 인스턴스 2개는 <strong>외부에서 접근이 불가능합니다.</strong></p>\n<ul>\n<li>NAT 인스턴스(퍼블릭)을 통해 SSH로 로컬 접속</li>\n</ul>\n</li>\n<li>NAT 인스턴스의 <u>프라이빗 IP 정보 확인</u> &#x26; NAT 인스턴스에 연결된 <u>탄력적 IP 정보 확인</u></li>\n</ul>\n<p><img src=\"https://user-images.githubusercontent.com/66216102/121612695-de183b80-ca95-11eb-87a4-8af459d8c359.JPG\" alt=\"1  넷 인스턴스의 정보 확인\"></p>\n<ul>\n<li>\n<p>프라이빗 EC2 인스턴스 정보 확인</p>\n<ul>\n<li>2개의 프라이빗 EC2 모두 외부와 연결이 되지 않습니다.</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://user-images.githubusercontent.com/66216102/121612701-df496880-ca95-11eb-813c-23de1a8b9168.JPG\" alt=\"1-1  프라이빗 이씨투 확인\"></p>\n<h2 id=\"nat-인스턴스-실습-1\" style=\"position:relative;\"><a href=\"#nat-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%EC%8B%A4%EC%8A%B5-1\" aria-label=\"nat 인스턴스 실습 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT 인스턴스 실습</h2>\n<h3 id=\"nat-인스턴스-동작을-위한-스크립트-확인\" style=\"position:relative;\"><a href=\"#nat-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%EB%8F%99%EC%9E%91%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%ED%99%95%EC%9D%B8\" aria-label=\"nat 인스턴스 동작을 위한 스크립트 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT 인스턴스 동작을 위한 스크립트 확인</h3>\n<ul>\n<li>NAT 인스턴스 동작을 위해서 <code class=\"language-text\">IPv4 라우팅 처리</code>와 <code class=\"language-text\">IP masquerade</code> 동작을 확인</li>\n</ul>\n<p><img src=\"https://user-images.githubusercontent.com/66216102/121612704-df496880-ca95-11eb-839f-3a0ad168693f.JPG\" alt=\"1-2 인스턴스 동작을 위한 스크립트 확인\"></p>\n<blockquote>\n<p>IP masquerade: 리눅스에서 지원하는 네트워킹의 한 기능</p>\n<ul>\n<li>내부 인스턴스의 IP와 포트를 NAT 인스턴스의 IP와 포트로 변환(PAT)</li>\n</ul>\n</blockquote>\n<h3 id=\"nat-인스턴스-동작을-위한-설정\" style=\"position:relative;\"><a href=\"#nat-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%EB%8F%99%EC%9E%91%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%84%A4%EC%A0%95\" aria-label=\"nat 인스턴스 동작을 위한 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT 인스턴스 동작을 위한 설정</h3>\n<ul>\n<li>NAT 인스턴스 동작을 위한 설정은 <strong><u>프라이빗 서브넷에 라우팅 정보 추가</u></strong>, <strong><u>소스/대상 확인 비활성화</u></strong>를 2 단계를 통해 이루어짐</li>\n</ul>\n<h4 id=\"프라이빗-서브넷에-라우팅-정보-추가\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%9D%BC%EC%9D%B4%EB%B9%97-%EC%84%9C%EB%B8%8C%EB%84%B7%EC%97%90-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%A0%95%EB%B3%B4-%EC%B6%94%EA%B0%80\" aria-label=\"프라이빗 서브넷에 라우팅 정보 추가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프라이빗 서브넷에 라우팅 정보 추가</h4>\n<ul>\n<li>현재 프라이빗 서브넷에 외부 인터넷과 통신하기 위한 라우팅 정보가 없기 때문에 해당 정보를 추가해야 합니다.</li>\n<li>경로: 서비스 - VPC - 가상 프라이빗 클라우드 - 라우팅 테이블 - NATInstance-PrivateRT1 선택 - 라우팅 탭 선택 - 라우팅 편집 클릭</li>\n</ul>\n<p><img src=\"https://user-images.githubusercontent.com/66216102/121612705-dfe1ff00-ca95-11eb-9267-50a6648a6c56.JPG\" alt=\"1-3 프라이빗-라우팅테이블 설정\"></p>\n<ul>\n<li>외부 통신을 위한 라우팅 정보 추가</li>\n</ul>\n<p><img src=\"https://user-images.githubusercontent.com/66216102/121612706-dfe1ff00-ca95-11eb-8473-a4e19bda96bb.JPG\" alt=\"1-4 외부 통신을 위한 라우팅테이블 설정\"></p>\n<h4 id=\"소스대상-확인-비활성화중지\" style=\"position:relative;\"><a href=\"#%EC%86%8C%EC%8A%A4%EB%8C%80%EC%83%81-%ED%99%95%EC%9D%B8-%EB%B9%84%ED%99%9C%EC%84%B1%ED%99%94%EC%A4%91%EC%A7%80\" aria-label=\"소스대상 확인 비활성화중지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>소스/대상 확인 비활성화(중지)</h4>\n<ul>\n<li>\n<p>기본적으로 인스턴스로 인입되거나 나가는 <strong>트래픽이(자신의 - 출발지IP, 목적지IP)가 아닐 경우 폐기</strong>합니다.</p>\n<ul>\n<li>해당 기능은 <strong><u>소스/대상 확인</u></strong>이며, 기본적으로 VPC의 네트워크 인터페이스(ENI)는 활성화 상태입니다.</li>\n</ul>\n</li>\n<li>소스/대상 확인을 비활성화 해야, <strong><u>자신이 목적지가 아닌 트래픽이 NAT 인스턴스를 경유해서 외부로 나갈 수 있기 때문입니다.</u></strong></li>\n<li>경로: 서비스 - EC2 - 인스턴스 - 인스턴스(NAT-Instance) - 작업 - 네트워킹 - 소스/대상 확인 변경 선택 클릭</li>\n</ul>\n<p><img src=\"https://user-images.githubusercontent.com/66216102/121612707-e07a9580-ca95-11eb-8057-afe8930404fe.JPG\" alt=\"1-5 nat-instance 소스,대상 확인 비활성화\"></p>\n<ul>\n<li>프라이빗 서브넷 라우팅 정보 추가, 소스/대상 확인 비활성화 작업을 통해 NAT 인스턴스 동작 설정 완료</li>\n</ul>\n<h3 id=\"프라이빗-서브넷에-위치한-인스턴스에서-외부로-통신-확인\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%9D%BC%EC%9D%B4%EB%B9%97-%EC%84%9C%EB%B8%8C%EB%84%B7%EC%97%90-%EC%9C%84%EC%B9%98%ED%95%9C-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4%EC%97%90%EC%84%9C-%EC%99%B8%EB%B6%80%EB%A1%9C-%ED%86%B5%EC%8B%A0-%ED%99%95%EC%9D%B8\" aria-label=\"프라이빗 서브넷에 위치한 인스턴스에서 외부로 통신 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프라이빗 서브넷에 위치한 인스턴스에서 외부로 통신 확인</h3>\n<ul>\n<li>외부와 ping(ICMP) 모두 확인</li>\n</ul>\n<blockquote>\n<p>ICMP[Internet Control Message Protocol]: 인터넷 제어 메시지 프로토콜</p>\n<ul>\n<li>\n<p>용도</p>\n<ul>\n<li>오류 메시지를 전송받는 데 주로 이용</li>\n<li><strong>ICMP 프로토콜은 Network 계층에 속하며 IP 프로토콜과 같이 사용한다!</strong></li>\n</ul>\n</li>\n<li>\n<p>사용 명령어</p>\n<ul>\n<li>Ping 명령어: 상대방 호스트의 작동 여부 및 응답시간 측정</li>\n<li>Tracert 명령어: 목적지까지의 라우팅 경로 추적을 하기 위해 사용</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<p><img src=\"https://user-images.githubusercontent.com/66216102/121612709-e07a9580-ca95-11eb-9c2e-2baad70ec56f.JPG\" alt=\"1-6 외부로 통신확인\"></p>\n<h4 id=\"nat-인스턴스에서-tcpdump-명령어로-트래픽이-경유하는지-확인\" style=\"position:relative;\"><a href=\"#nat-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4%EC%97%90%EC%84%9C-tcpdump-%EB%AA%85%EB%A0%B9%EC%96%B4%EB%A1%9C-%ED%8A%B8%EB%9E%98%ED%94%BD%EC%9D%B4-%EA%B2%BD%EC%9C%A0%ED%95%98%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8\" aria-label=\"nat 인스턴스에서 tcpdump 명령어로 트래픽이 경유하는지 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT 인스턴스에서 tcpdump 명령어로 트래픽이 경유하는지 확인</h4>\n<ul>\n<li>\n<p><code class=\"language-text\">tcpdump</code> 명령어를 통해 NAT-Instance에서 경유하는지 확인</p>\n<ul>\n<li>사진에서 보듯이 프라이빗 EC2(102번)이 NAT-Instance를 거쳐 외부와 연결을 주고 받는 모습입니다.</li>\n<li><u><strong><em>10.40.2.101</em> 출발지 IP가 <em>10.40.1.100</em> 으로 변환되는 것을 확인</strong></u></li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://user-images.githubusercontent.com/66216102/121612711-e1132c00-ca95-11eb-913e-cdc5703afa5d.JPG\" alt=\"1-7 tcpdump 명령어를 사용해 트래픽 경유확인\"></p>\n<h3 id=\"자원-삭제-1\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EC%9B%90-%EC%82%AD%EC%A0%9C-1\" aria-label=\"자원 삭제 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자원 삭제</h3>\n<ul>\n<li>CloudFormation 스택 삭제</li>\n</ul>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<p><a href=\"https://run-it.tistory.com/31\">https://run-it.tistory.com/31</a></p>","frontmatter":{"title":"[AWS] NAT 인스턴스를 통한 인터넷 연결","date":"June 10, 2021","category":"☁️ cloud"}}},"pageContext":{"slug":"/cloud/[AWS] NAT 인스턴스를 통한 인터넷 연결/","previous":{"fields":{"slug":"/cloud/[AWS] Proxy (Squid) Instance - VPC Outbound Filtering/"},"frontmatter":{"title":"[AWS] Proxy (Squid) Instance - VPC Outbound Filtering","category":"☁️ cloud","draft":false}},"next":{"fields":{"slug":"/cloud/[AWS] ELB(부하 분산)/"},"frontmatter":{"title":"[AWS] ELB(부하 분산)","category":"☁️ cloud","draft":false}}}},"staticQueryHashes":["3128451518","521680639"]}