{"componentChunkName":"component---src-templates-blog-post-js","path":"/docker/ì¥ê³ í”„ë¡œì íŠ¸ dockerë¡œ ë°°í¬í•˜ê¸° with elasticsearch/","result":{"data":{"site":{"siteMetadata":{"title":"Woo's Dev Log","author":"nickhealthy","siteUrl":"https://nickhealthy.github.io","comment":{"disqusShortName":"","utterances":"nickhealthy/nickhealthy.github.io"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"2948cd5d-c3e6-568a-b6db-e454aee6d308","excerpt":"ë©€í‹°ìº í¼ìŠ¤ í´ë¼ìš°ë“œ êµìœ¡ê³¼ì •ì„ ë“¤ìœ¼ë©´ì„œ ë„ì»¤, ì¿ ë²„ë„¤í‹°ìŠ¤, í´ë¼ìš°ë“œ ë“± ì „ë°˜ì ìœ¼ë¡œ ë§ì€ ê²ƒì„ ë°°ì› ë‹¤.\nê·¸ ì¤‘ 1ì°¨ í”„ë¡œì íŠ¸ëŠ” ì¥ê³  ì›¹ í”„ë¡œì íŠ¸ì˜€ëŠ”ë° ì´ë•ŒëŠ” íŒŒì´ì¬, ì›¹ ìŠ¤í¬ë˜í•‘, ë°ì´í„° ì¡°ì‘ì„ ìœ„í•œ pandas, ì¥ê³ , SQL/NoSQL ì •ë„ë§Œ ë°°ì› ë‹¤.\nê·¸ë¦¬ê³  ì´í›„ì— 2ì°¨ 3ì°¨ í”„ë¡œì íŠ¸ë¥¼ ìˆ˜í–‰í–ˆì„ ë•Œ AWSâ€¦","html":"<p>ë©€í‹°ìº í¼ìŠ¤ í´ë¼ìš°ë“œ êµìœ¡ê³¼ì •ì„ ë“¤ìœ¼ë©´ì„œ ë„ì»¤, ì¿ ë²„ë„¤í‹°ìŠ¤, í´ë¼ìš°ë“œ ë“± ì „ë°˜ì ìœ¼ë¡œ ë§ì€ ê²ƒì„ ë°°ì› ë‹¤.\nê·¸ ì¤‘ 1ì°¨ í”„ë¡œì íŠ¸ëŠ” ì¥ê³  ì›¹ í”„ë¡œì íŠ¸ì˜€ëŠ”ë° ì´ë•ŒëŠ” íŒŒì´ì¬, ì›¹ ìŠ¤í¬ë˜í•‘, ë°ì´í„° ì¡°ì‘ì„ ìœ„í•œ pandas, ì¥ê³ , SQL/NoSQL ì •ë„ë§Œ ë°°ì› ë‹¤.\nê·¸ë¦¬ê³  ì´í›„ì— 2ì°¨ 3ì°¨ í”„ë¡œì íŠ¸ë¥¼ ìˆ˜í–‰í–ˆì„ ë•Œ AWS ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ë©´ì„œ í´ë¼ìš°ë“œìª½ì€ ê±´ë“œë ¤ ë³¸ê²ƒ ê°™ì€ë° ê°€ìƒí™” ì»¨í…Œì´ë„ˆì˜ ê¸°ìˆ ë¡œì„œëŠ” í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•´ë³´ì§€ ì•Šì€ ê²ƒ ê°™ì•„ ìˆ˜ë£Œ ì´í›„ ë„ì»¤ë¥¼ ê³µë¶€í•  ê²¸ ë°°í¬í•´ë³´ê¸°ë¡œ í–ˆë‹¤.</p>\n<blockquote>\n<p>í•´ê²°í•˜ëŠ”ë° ìƒê°ë³´ë‹¤ ì •ë§ ì˜¤ë˜ê±¸ë ¸ë‹¤â€¦ DBì™€ ì¥ê³  ì„œë²„ <code class=\"language-text\">Dockerfile</code> ì‘ì„± ë° <code class=\"language-text\">docker-compose</code> ì—°ë™ì€ ë¹„êµì  ì‰½ê²Œ ë˜ì—ˆì§€ë§Œ <code class=\"language-text\">elasticsearch</code> ì»¨í…Œì´ë„ˆì™€ì˜ ì—°ë™ì´ ì•ˆë˜ì—ˆë˜ ê²ƒ..</p>\n<p>ê²°ê³¼ì ìœ¼ë¡œ í•´ê²°ë˜ì—ˆê³  ì—ëŸ¬ë¥¼ í•´ê²°í•˜ëŠë¼ ëŒê³  ëŒì•„ ë¦¬ëˆ…ìŠ¤, ë„ì»¤ ë„¤íŠ¸ì›Œí¬, ì—˜ë¼ìŠ¤í‹± ì„œì¹˜ ë“±ë“± ë§ì€ ê²ƒì„ ê³µë¶€í•´ì„œ ì†í•´ëŠ” ì•„ë‹ˆë¼ê³  ìƒê°í•œë‹¤.</p>\n</blockquote>\n<h2 id=\"ë°©ë²•1-dockerfile-ì •ì˜\" style=\"position:relative;\"><a href=\"#%EB%B0%A9%EB%B2%951-dockerfile-%EC%A0%95%EC%9D%98\" aria-label=\"ë°©ë²•1 dockerfile ì •ì˜ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ë°©ë²•1. Dockerfile ì •ì˜</h2>\n<p>ì²˜ìŒì—ëŠ” ë„ì»¤ íŒŒì¼ì„ ê°œë³„ì ìœ¼ë¡œ ì •ì˜í•´ <strong>ê°ê°ì˜ ì»¨í…Œì´ë„ˆë“¤ì„ ì—°ê²°í•´ë³´ì•˜ë‹¤.</strong></p>\n<blockquote>\n<p>ì—¬ê¸°ì„œë¶€í„° DB, ì¥ê³ ëŠ” ì—°ë™ì´ ì™„ë£Œ ë˜ì—ˆê³ , ì¥ê³  ì„œë²„ë„ ì •ìƒì ìœ¼ë¡œ ëŒì•„ê°”ì§€ë§Œ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ëŠ” ì•ˆë˜ëŠ” ìƒíƒœì˜€ìŒ</p>\n</blockquote>\n<ul>\n<li>ì—˜ë¼ìŠ¤í‹± ì„œë²„ ì‹¤í–‰ í™•ì¸ ëª…ë ¹ì–´</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> http://localhost:9200/_cluster/health?pretty</code></pre></div>\n<ol>\n<li>mariaDB ì„œë²„ ì‹¤í–‰</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker run --rm --name db -e <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span>project -e <span class=\"token assign-left variable\">MYSQL_DATABASE</span><span class=\"token operator\">=</span>project_db -e <span class=\"token assign-left variable\">MYSQL_USER</span><span class=\"token operator\">=</span>project -e <span class=\"token assign-left variable\">MYSQL_PASSWORD</span><span class=\"token operator\">=</span>project mariadb</code></pre></div>\n<blockquote>\n<p>mariaDBëŠ” ë”±íˆ ë„ì»¤ íŒŒì¼ì„ ì•ˆë§Œë“¤ì–´ì¤˜ë„ ë ê±°ê°™ì•„ì„œ ê³µì‹ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë°›ëŠ” ë™ì‹œì— ì„œë²„ë¥¼ ì‹¤í–‰ì‹œì¼°ë‹¤.</p>\n</blockquote>\n<ol start=\"2\">\n<li>backend <code class=\"language-text\">Dockerfile</code> ì •ì˜</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> python<span class=\"token punctuation\">:</span>3.8.5\n\n<span class=\"token keyword\">RUN</span> apt<span class=\"token punctuation\">-</span>get <span class=\"token punctuation\">-</span>y update\n<span class=\"token keyword\">RUN</span> pip install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>upgrade pip\n<span class=\"token comment\"># í”„ë¡œì íŠ¸ íŠ¹ì„±ìƒ í•„ìš”í•œ ë¹„ë””ì˜¤ ì¸ì½”ë”© íŒŒì¼ ì„¤ì¹˜</span>\n<span class=\"token keyword\">RUN</span> apt<span class=\"token punctuation\">-</span>get install <span class=\"token punctuation\">-</span>y ffmpeg\n\n<span class=\"token keyword\">WORKDIR</span> /usr/src/app\n<span class=\"token keyword\">COPY</span> requirements.txt /usr/src/app\n<span class=\"token comment\"># í”„ë¡œì íŠ¸ì— í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ê°€ìƒí™˜ê²½ìœ¼ë¡œ í•œë²ˆì— ì„¤ì¹˜ ë° ê´€ë¦¬</span>\n<span class=\"token keyword\">RUN</span> pip install <span class=\"token punctuation\">-</span>r requirements.txt\n<span class=\"token keyword\">COPY</span> . /usr/src/app</code></pre></div>\n<ol start=\"3\">\n<li>backend <code class=\"language-text\">Dockerfile</code> ì´ë¯¸ì§€ë¥¼ ë¹Œë“œ</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker build -t backend <span class=\"token builtin class-name\">.</span></code></pre></div>\n<ol start=\"4\">\n<li>mariaDBì™€ backend ì—°ë™ ë° ì‹¤í–‰</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker run -it -d --rm --name backend -p <span class=\"token number\">8000</span>:8000 --link db -e <span class=\"token assign-left variable\">DJANGO_DB_HOST</span><span class=\"token operator\">=</span>db -e <span class=\"token assign-left variable\">DJANGO_DEBUG</span><span class=\"token operator\">=</span>True backend</code></pre></div>\n<blockquote>\n<p>â€”link: ì—°ê²°í•  ì»¨í…Œì´ë„ˆ ì´ë¦„</p>\n</blockquote>\n<ol start=\"5\">\n<li>ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì—¬ë¶€ í™•ì¸</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker <span class=\"token function\">ps</span> -a</code></pre></div>\n<ol start=\"6\">\n<li>backend ì»¨í…Œì´ë„ˆ ë‚´ ì§„ì…</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker <span class=\"token builtin class-name\">exec</span> -it backend <span class=\"token function\">bash</span></code></pre></div>\n<ol start=\"7\">\n<li>django ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ í•„ìš”í•œ ì„¤ì • ëª…ë ¹ì–´ &#x26; django ì„œë²„ ì‹¤í–‰</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ python manage.py makemigrations\n$ python manage.py migrate\n$ python manage.py runserver <span class=\"token number\">0</span>:8000</code></pre></div>\n<ol start=\"8\">\n<li>\n<p>localhostì—ì„œ ì ‘ì†ë˜ëŠ” ê²ƒì„ í™•ì¸</p>\n<ul>\n<li>ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ <code class=\"language-text\">localhost:8000</code> ì…ë ¥ í›„ ì ‘ì†</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"docker-composeë¡œ-ë³€ê²½\" style=\"position:relative;\"><a href=\"#docker-compose%EB%A1%9C-%EB%B3%80%EA%B2%BD\" aria-label=\"docker composeë¡œ ë³€ê²½ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker-composeë¡œ ë³€ê²½</h2>\n<p>ì´ë ‡ê²Œê¹Œì§€ í•´ì„œ ê°ê°ì˜ ë„ì»¤ ì»¨í…Œì´ë„ˆë“¤ë¼ë¦¬ ë””ë¹„ì™€ ì¥ê³ ê°€ ì—°ë™ë˜ì—ˆê³  ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆì—ˆë‹¤.(ê²€ìƒ‰ì—”ì§„ì¸ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ ì„œë²„ë¥¼ ì œì™¸í•˜ê³ )</p>\n<p>í•˜ì§€ë§Œ ì»¨í…Œì´ë„ˆ ë‚´ì— ì§„ì…í•´ì„œ ì„¤ì •ì„ í•´ì£¼ëŠ” ê²ƒë„ ë§ê³  ë³µì¡í•˜ë‹¤. ì´ì œ ì´ê²ƒì„ docker-composeë¥¼ ì´ìš©í•´ ì¢€ ë” ìˆ˜ì›”í•˜ê²Œ ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë“¤ì„ í•œêº¼ë²ˆì— ë¹Œë“œí•˜ê³  ì„œë²„ê¹Œì§€ ë°”ë¡œ ì‹¤í–‰ë˜ë„ë¡ í•´ë³´ì•˜ë‹¤.</p>\n<p>backend <code class=\"language-text\">Dockerfile</code> ìˆ˜ì •</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> python<span class=\"token punctuation\">:</span>3.8.5\n\n<span class=\"token keyword\">RUN</span> apt<span class=\"token punctuation\">-</span>get <span class=\"token punctuation\">-</span>y update\n<span class=\"token keyword\">RUN</span> pip install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>upgrade pip\n<span class=\"token comment\"># í”„ë¡œì íŠ¸ íŠ¹ì„±ìƒ í•„ìš”í•œ ë¹„ë””ì˜¤ ì¸ì½”ë”© íŒŒì¼ ì„¤ì¹˜</span>\n<span class=\"token keyword\">RUN</span> apt<span class=\"token punctuation\">-</span>get install <span class=\"token punctuation\">-</span>y ffmpeg\n\n<span class=\"token keyword\">WORKDIR</span> /usr/src/app\n<span class=\"token keyword\">COPY</span> requirements.txt /usr/src/app\n<span class=\"token comment\"># í”„ë¡œì íŠ¸ì— í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ê°€ìƒí™˜ê²½ìœ¼ë¡œ í•œë²ˆì— ì„¤ì¹˜ ë° ê´€ë¦¬</span>\n<span class=\"token keyword\">RUN</span> pip install <span class=\"token punctuation\">-</span>r requirements.txt\n<span class=\"token keyword\">COPY</span> . /usr/src/app\n\n<span class=\"token keyword\">RUN</span> python manage.py migrate <span class=\"token comment\"># ëª…ë ¹ì–´ ì¶”ê°€</span></code></pre></div>\n<blockquote>\n<p>ì•„ì£¼ ì‚´ì§ ìˆ˜ì •í•˜ì˜€ì§€ë§Œ docker-compose.ymlì—ì„œ <code class=\"language-text\">depends_on</code> ì„ ì„¤ì •í•´ ì£¼ì—ˆìœ¼ë¯€ë¡œ ì¥ê³  ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ëœ í›„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì§„ì…ìœ¼ë¡œ migrate í•´ì¤„ í•„ìš”ì—†ì´ ìë™ì ìœ¼ë¡œ ì‹¤í–‰ì´ ë˜ë„ë¡í•˜ì˜€ë‹¤.</p>\n<p>ë˜í•œ docker-compose.ymlì—ì„œ runserver ê¹Œì§€ ì„ ì–¸í–ˆê¸° ë•Œë¬¸ì— <strong>docker-compose up ëª…ë ¹ìœ¼ë¡œ ìœ„ì—ì„œì™€ëŠ” ë‹¤ë¥´ê²Œ í•œë²ˆì— ì •ìƒì ìœ¼ë¡œ ì„œë²„ê°€ ì‹¤í–‰ëœë‹¤.</strong></p>\n</blockquote>\n<p><code class=\"language-text\">docker-compose.yml</code></p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\">version<span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span>\nservices<span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># DB ì»¨í…Œì´ë„ˆ ì´ë¦„ ì •ì˜</span>\n  database<span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># db ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•  ë„ì»¤ ì´ë¯¸ì§€</span>\n    image<span class=\"token punctuation\">:</span> <span class=\"token string\">'mariadb'</span>\n    environment<span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> MYSQL_ROOT_PASSWORD=project\n      <span class=\"token punctuation\">-</span> MYSQL_DATABASE=project_db\n      <span class=\"token punctuation\">-</span> MYSQL_USER=project\n      <span class=\"token punctuation\">-</span> MYSQL_PASSWORD=project\n\n<span class=\"token comment\"># ì—˜ë¼ìŠ¤í‹± ì„œì¹˜ ì»¨í…Œì´ë„ˆ ì—°ë™ì´ ì•ˆë˜ëŠ” ë¬¸ì œë¡œ DBì™€ djangoë§Œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ì£¼ì„ ì²˜ë¦¬í•´ë†“ì•˜ë‹¤.</span>\n  <span class=\"token comment\"># elasticsearch:</span>\n  <span class=\"token comment\">#   image: docker.elastic.co/elasticsearch/elasticsearch:7.10.2</span>\n  <span class=\"token comment\">#   ports:</span>\n  <span class=\"token comment\">#     - '9200:9200'</span>\n  <span class=\"token comment\">#     - '9300:9300'</span>\n  <span class=\"token comment\">#   expose:</span>\n  <span class=\"token comment\">#     - '8000'</span>\n  <span class=\"token comment\">#   environment:</span>\n  <span class=\"token comment\">#     - 'ES_JAVA_OPTS=-Xms512m -Xmx512m'</span>\n  <span class=\"token comment\">#     - discovery.type=single-node</span>\n\n  <span class=\"token comment\"># ì•± ì»¨í…Œì´ë„ˆ ì´ë¦„ ì •ì˜</span>\n  backend<span class=\"token punctuation\">:</span>\n  \t<span class=\"token comment\"># ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ëœ í›„ ì¥ê³  ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë„ë¡ ì„¤ì •</span>\n    depends_on<span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> database\n      <span class=\"token punctuation\">-</span> elasticsearch\n    <span class=\"token comment\"># Dockerfileì´ ìˆëŠ” ìœ„ì¹˜</span>\n    build<span class=\"token punctuation\">:</span> .\n    ports<span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'8000:8000'</span>\n    environment<span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> DJANGO_DB_HOST=database\n      <span class=\"token punctuation\">-</span> DJANGO_DEBUG=True\n    command<span class=\"token punctuation\">:</span> python manage.py runserver 0<span class=\"token punctuation\">:</span>8000</code></pre></div>\n<ol>\n<li><code class=\"language-text\">docker-compose build</code> ëª…ë ¹ì–´ë¡œ ë¹Œë“œë¥¼ ì§„í–‰</li>\n<li><code class=\"language-text\">docker-compose up</code> ëª…ë ¹ì–´ë¡œ ì‹¤í–‰</li>\n</ol>\n<p>ì •ìƒì ìœ¼ë¡œ ì„œë²„ê°€ ì‹¤í–‰ëœë‹¤. ë˜í•œ ìœ„ì˜ ë„ì»¤ íŒŒì¼ì—ì„œëŠ” <code class=\"language-text\">--link</code> ë¼ëŠ” ì˜µì…˜ì„ ì¤˜ì„œ ê° ì»¨í…Œì´ë„ˆë¥¼ ì—°ê²°ì‹œì¼œì£¼ì—ˆëŠ”ë° í•´ë‹¹ <code class=\"language-text\">docker-compose.yml</code> ì„ ë³´ë©´ ì˜µì…˜ì´ ë¹ ì ¸ìˆë‹¤.</p>\n<p><strong>ê·¸ ì´ìœ ëŠ” docker-composeì—ì„œëŠ” ë³„ë„ì˜ ë„¤íŠ¸ì›Œí¬ ì˜µì…˜ì„ ì„¤ì •í•´ì£¼ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ì— ì„œë¡œ ì—°ê²°ë˜ì–´ ìˆê¸° ë•Œë¬¸ì´ë‹¤.</strong></p>\n<h2 id=\"ë°©ë²•2-ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ê¹Œì§€-ì¶”ê°€\" style=\"position:relative;\"><a href=\"#%EB%B0%A9%EB%B2%952-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98%EA%B9%8C%EC%A7%80-%EC%B6%94%EA%B0%80\" aria-label=\"ë°©ë²•2 ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ê¹Œì§€ ì¶”ê°€ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ë°©ë²•2. ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ê¹Œì§€ ì¶”ê°€</h2>\n<p>ìš°ì„  ë¬´ì‘ì • ì°ë“¯ì´ í•˜ì§€ë§ê³ , ì›ì¸ì„ íŒŒì•…í•˜ìê³  ìƒê°í–ˆë‹¤. ì•ˆë˜ëŠ” ì´ìœ ë¥¼ ì•Œê¸° ìœ„í•´ì„œ ê³ ì‹¬í•´ë³´ë‹¤ê°€ ê¸°ì¡´ì— í˜¸ìŠ¤íŠ¸ PCì—ì„œëŠ” ì •ìƒì ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì‹¤í–‰ì´ ëœë‹¤ëŠ” ê²ƒì„ ìƒê°í•˜ê³  <strong>ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì—ì„œ ì—˜ë¼ìŠ¤í‹± ì„œë²„ê°€ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ë¨¼ì € íŒŒì•…</strong>í•˜ê¸°ë¡œ í–ˆë‹¤. <strong>ì¦‰, ë¡œì»¬ í™˜ê²½ì—ì„œ ì‘ë™ë°©ì‹ì„ ë³´ê³  í…ŒìŠ¤íŠ¸í–ˆë‹¤ëŠ” ì–˜ê¸°</strong></p>\n<p>ìš°ì„  ìš°ë¦¬ í”„ë¡œì íŠ¸ëŠ” ì—˜ë¼ìŠ¤í‹± ì„œì¹˜ ì„œë²„ì™€ ì¥ê³ ì„œë²„ê°€ ê°™ì´ ì›€ì§ì¸ë‹¤ëŠ” ì ì—ì„œ ì—°ê´€ëœ ê¸°ëŠ¥ë“¤ì€ í•˜ë‚˜ì˜ ì»¨í…Œì´ë„ˆì— ë‹´ìëŠ” ìƒê°ì„ í–ˆë‹¤. (í•­ìƒ ì—˜ë¼ìŠ¤í‹± ì„œì¹˜ë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ê³  ì¥ê³  ì„œë²„ë¥¼ ì‹¤í–‰í•œë‹¤ëŠ” ì ì—ì„œ) ê·¸ë¦¬ê³  ì—˜ë¼ìŠ¤í‹± ì„œì¹˜ ê³µì‹ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì˜€ì„ ë•Œ ì¥ê³  í”„ë¡œì íŠ¸ì— í•„ìš”í•œ ëª¨ë“ˆê³¼ íŒ¨í‚¤ì§€ë“¤ì€ ì•„ë˜ì˜ ë‚´ìš©ê³¼ ê°™ë‹¤. ë˜í•œ <code class=\"language-text\">RUN</code> ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ê²½ìš° ë„ì»¤ ì´ë¯¸ì§€ì—ì„œëŠ” íŠ¹ì • ë ˆì´ì–´ë¥¼ ìƒì„±í•œë‹¤ê³  í•œë‹¤. ì´ ë ˆì´ì–´ëŠ” í•œë²ˆ ì •ì˜í•˜ê³  ë¹Œë“œí–ˆì„ ë•Œ ê·¸ ìƒíƒœë¥¼ ê³ ì •/ìœ ì§€í•˜ë©°, ì—¬ëŸ¬ ê°œì˜ RUN ëª…ë ¹ì–´ë¥¼ ë‚¨ë°œí•  ê²½ìš° ë ˆì´ì–´ê°€ ì—¬ëŸ¬ê°œê°€ ëœë‹¤ëŠ” ì‚¬ì‹¤ì´ë‹¤. ê·¸ë˜ì„œ ìµœëŒ€í•œ íš¨ìœ¨ì ìœ¼ë¡œ ë¹Œë“œí•˜ê¸° ìœ„í•´ í•˜ë‚˜ì˜ <code class=\"language-text\">RUN</code> ëª…ë ¹ì–´ ì•ˆì—ì„œ ë¹Œë“œí•´ ì£¼ì—ˆë‹¤.</p>\n<p>[Dockerfile] ìˆ˜ì •</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> elasticsearch<span class=\"token punctuation\">:</span>7.10.1\n\n<span class=\"token keyword\">WORKDIR</span> /usr/src/app\n<span class=\"token keyword\">COPY</span> requirements.txt /usr/src/app\n\n<span class=\"token keyword\">RUN</span> yum install <span class=\"token punctuation\">-</span>y gcc openssl<span class=\"token punctuation\">-</span>devel bzip2<span class=\"token punctuation\">-</span>devel libffi<span class=\"token punctuation\">-</span>devel wget make &amp;&amp; \\\n    wget https<span class=\"token punctuation\">:</span>//www.python.org/ftp/python/3.8.5/Python<span class=\"token punctuation\">-</span>3.8.5.tgz &amp;&amp; \\\n    tar xzf Python<span class=\"token punctuation\">-</span>3.8.5.tgz &amp;&amp; \\\n    Python<span class=\"token punctuation\">-</span>3.8.5/configure <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>enable<span class=\"token punctuation\">-</span>optimizations &amp;&amp; \\\n    make altinstall Python<span class=\"token punctuation\">-</span>3.8.5 &amp;&amp; \\\n    ln <span class=\"token punctuation\">-</span>s /usr/local/bin/python3.8 /bin/python3.8 &amp;&amp; \\\n    yum install <span class=\"token punctuation\">-</span>y python3<span class=\"token punctuation\">-</span>devel mysql<span class=\"token punctuation\">-</span>devel &amp;&amp; \\\n    pip3.8 install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>upgrade pip &amp;&amp; \\\n    pip3.8 install <span class=\"token punctuation\">-</span>r requirements.txt &amp;&amp; \\\n    wget https<span class=\"token punctuation\">:</span>//raw.githubusercontent.com/q3aql/ffmpeg<span class=\"token punctuation\">-</span>install/master/ffmpeg<span class=\"token punctuation\">-</span>install &amp;&amp; \\\n    chmod a+x ffmpeg<span class=\"token punctuation\">-</span>install &amp;&amp; \\\n    ./ffmpeg<span class=\"token punctuation\">-</span>install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>install release\n\n<span class=\"token keyword\">COPY</span> . /usr/src/app\n<span class=\"token keyword\">CMD</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"python3.8\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"manage.py\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"runserver\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"0:8000\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>ë˜í•œ ì—¬ëŸ¬ ê°œì˜ íŠ¹ì • ì‘ì—… ì²˜ë¦¬ë¥¼ ìœ„í•´ RUN ëª…ë ¹ì–´ ëŒ€ì‹  í•˜ë‚˜ì˜ ì‰˜ ìŠ¤í¬ë¦½ë¥¼ ë§Œë“¤ì–´ ëª¨ë‘ ì²˜ë¦¬í•˜ë„ë¡ í•˜ì˜€ë‹¤. sleep ì‹œê°„ì€ ê°ê°ì˜ ëª…ë ¹ì–´ ì²˜ë¦¬ë¥¼ ìœ„í•´ ê¸°ë‹¤ë¦´ ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•¨ì´ë‹¤.</p>\n<p>ë˜í•œ <code class=\"language-text\">/usr/local/bin/docker-entrypoint.sh &amp;</code> ì´ ëª…ë ¹ì–´ëŠ” ì—˜ë¼ìŠ¤í‹± ì„œì¹˜ë¥¼ ë°ëª¬(daemon)ìœ¼ë¡œ ëŒë¦¬ê¸° ìœ„í•¨ì´ë©° í¬ê·¸ë¼ìš´ë“œë¡œ ë„ëŠ” ì„œë²„ëŠ” ì¥ê³  ì„œë²„ì´ë‹¤.</p>\n<p>[server_start.sh] ìƒì„±</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token shebang important\">#!/bin/bash -x</span>\n\n<span class=\"token function\">sleep</span> <span class=\"token number\">15</span>\n\npython3.8 manage.py migrate\n\n/usr/local/bin/docker-entrypoint.sh <span class=\"token operator\">&amp;</span>\n\n<span class=\"token function\">sleep</span> <span class=\"token number\">25</span>\n\npython3.8 manage.py search_index -f --rebuild\n\n<span class=\"token function\">sleep</span> <span class=\"token number\">5</span>\n\npython3.8 manage.py runserver <span class=\"token number\">0</span>:8000</code></pre></div>\n<p>ì²˜ìŒì—ëŠ” DB, ì—˜ë¼ìŠ¤í‹± ì„œì¹˜, ë°±ì—”ë“œ(ì¥ê³ )ë¡œ ë‚˜ëˆ„ì–´ ì´ 3ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ì»´í¬ì¦ˆ íŒŒì¼ì— ì •ì˜í–ˆì—ˆë‹¤. í•˜ì§€ë§Œ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ì— (ì»´í¬ì¦ˆì— ë¬¶ëŠ” ì»¨í…Œì´ë„ˆ íŒŒì¼ë“¤ì„ ê¸°ë³¸ì ìœ¼ë¡œ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ì— ë¬¶ì´ê²Œ ëœë‹¤.) ì»¨í…Œì´ë„ˆê°€ ìˆê³  ì„œë¡œ í†µì‹ ì´ ë˜ëŠ” ê²ƒì„ í™•ì¸í•´ë´ë„ ì—˜ë¼ìŠ¤í‹± ì„œì¹˜ê°€ ì‘ë™ì„ í•˜ì§€ ì•Šì•˜ë‹¤. ë‚˜ì¤‘ì—ì•¼ ì•Œê²Œ ëœ ì‚¬ì‹¤ì´ì§€ë§Œ ì»´í¬ì¦ˆ íŒŒì¼ì„ ì‹¤í–‰(up) í•œ ë’¤ <code class=\"language-text\">exec serviceëª…ì¹­</code> ëª…ë ¹í•˜ë©´ ë˜ëŠ” ê²ƒ ê°™ì•˜ì§€ë§Œ, ë‚˜ëŠ” <code class=\"language-text\">docker-compose up</code> ëª…ë ¹ì–´ë¥¼ ì³¤ì„ ë•Œ ë‚´ë¶€ì ìœ¼ë¡œ ì„¤ì •í•´ ì¤˜ì•¼í•˜ëŠ” ë¹Œë“œë„ ìë™í™”í•˜ê³  ì‹¶ì–´ ì´ë ‡ê²Œ ì„¤ê³„í•˜ê²Œ ë˜ì—ˆë‹¤. ì•„ë˜ì— ìˆëŠ” ì»´í¬ì¦ˆ íŒŒì¼ì€ MariaDB ê³µì‹ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ í™˜ê²½ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ê³  DBê°€ ì‹¤í–‰ë˜ì—ˆì„ ë•Œ ì•„ë˜ <code class=\"language-text\">backend</code> ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ êµ¬ì„±í–ˆë‹¤.</p>\n<p>[docker-compose.yml]</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\">version<span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span>\nservices<span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># DB ì»¨í…Œì´ë„ˆ ì´ë¦„ ì •ì˜</span>\n  database<span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># db ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•  ë„ì»¤ ì´ë¯¸ì§€</span>\n    image<span class=\"token punctuation\">:</span> <span class=\"token string\">'mariadb'</span>\n    environment<span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> MYSQL_ROOT_PASSWORD=project\n      <span class=\"token punctuation\">-</span> MYSQL_DATABASE=project_db\n      <span class=\"token punctuation\">-</span> MYSQL_USER=project\n      <span class=\"token punctuation\">-</span> MYSQL_PASSWORD=project\n\n  <span class=\"token comment\"># ì•± ì»¨í…Œì´ë„ˆ ì´ë¦„ ì •ì˜</span>\n  backend<span class=\"token punctuation\">:</span>\n    depends_on<span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> database\n    <span class=\"token comment\"># Dockerfileì´ ìˆëŠ” ìœ„ì¹˜</span>\n    build<span class=\"token punctuation\">:</span> .\n    ports<span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'8000:8000'</span>\n    environment<span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> DJANGO_DB_HOST=database\n      <span class=\"token punctuation\">-</span> DJANGO_DEBUG=True\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'ES_JAVA_OPTS=-Xms512m -Xmx512m'</span>\n      <span class=\"token punctuation\">-</span> discovery.type=single<span class=\"token punctuation\">-</span>node\n    command<span class=\"token punctuation\">:</span> ./server_start.sh</code></pre></div>\n<p>ì´ë ‡ê²Œ ëª¨ë‘ ì‘ì„±í•˜ê³  <code class=\"language-text\">docker-compose.yml</code> íŒŒì¼ì´ ìˆëŠ” ê³³ì—ì„œ <code class=\"language-text\">docker-compose up</code> ëª…ë ¹ì–´ë¥¼ ì¹˜ë©´ ì •ìƒì ìœ¼ë¡œ ë„ì»¤ë¡œ ë§Œë“  ì¥ê³  í”„ë¡œì íŠ¸ê°€ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆì—ˆë‹¤.</p>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#_set_vm_max_map_count_to_at_least_262144\">https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#_set<em>vm</em>max<em>map</em>count<em>to</em>at<em>least</em>262144</a></p>\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html\">https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html</a></p>\n<p><a href=\"https://msyu1207.tistory.com/entry/Elasticsearch-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%99%B8%EB%B6%80-%ED%97%88%EC%9A%A9\">https://msyu1207.tistory.com/entry/Elasticsearch-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%99%B8%EB%B6%80-%ED%97%88%EC%9A%A9</a></p>\n<p><a href=\"https://okayjava.tistory.com/30\">https://okayjava.tistory.com/30</a></p>\n<p><a href=\"https://mentha2.tistory.com/177\">https://mentha2.tistory.com/177</a></p>\n<p><a href=\"https://medium.com/@ian.nam.kr/elasticsearch-%EC%84%A4%EC%B9%98-973fb438f2\">https://medium.com/@ian.nam.kr/elasticsearch-%EC%84%A4%EC%B9%98-973fb438f2</a></p>\n<p><a href=\"https://jhnyang.tistory.com/268\">https://jhnyang.tistory.com/268</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=xFcJPwVPc1o&#x26;t=1449s\">https://www.youtube.com/watch?v=xFcJPwVPc1o&#x26;t=1449s</a></p>","frontmatter":{"title":"ì¥ê³ í”„ë¡œì íŠ¸ dockerë¡œ ë°°í¬í•˜ê¸° with elasticsearch","date":"February 02, 2021","category":"ğŸ³ docker"}}},"pageContext":{"slug":"/docker/ì¥ê³ í”„ë¡œì íŠ¸ dockerë¡œ ë°°í¬í•˜ê¸° with elasticsearch/","previous":{"fields":{"slug":"/docker/Docker network/"},"frontmatter":{"title":"ë„ì»¤ ë„¤íŠ¸ì›Œí¬","category":"ğŸ³ docker","draft":false}},"next":{"fields":{"slug":"/solving-algo/[í”„ë¡œê·¸ë˜ë¨¸ìŠ¤]/[programmers]ì‚¼ê° ë‹¬íŒ½ì´/"},"frontmatter":{"title":"[programmers]ì‚¼ê° ë‹¬íŒ½ì´","category":"ğŸ’¯ solving-algo","draft":false}}}},"staticQueryHashes":["3128451518","521680639"]}